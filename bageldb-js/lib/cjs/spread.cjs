(()=>{"use strict";var e={454:(e,t,n)=>{n.d(t,{CH:()=>a,ej:()=>c,NR:()=>l,od:()=>i(),Zb:()=>f,$R:()=>b});const r=require("axios");var i=n.n(r),o=n(752);const a=function(){function e(e){var t=e.instance,n=e.collectionID;Object.defineProperty(this,"instance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"collectionID",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pageNumber",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"itemsPerPage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callEverything",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_query",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nestedCollectionsIDs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"axiosInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiToken",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_projectOn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_projectOff",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requestID",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_item",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_field",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sortField",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sortOrder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.instance=t,this.collectionID=n,this._pageNumber=1,this.itemsPerPage=100,this.callEverything=!1,this._query=[],this.nestedCollectionsIDs=[],this.axiosInstance=i().create(),this.apiToken=t.apiToken,this._projectOn="",this._projectOff="",this.requestID="",this.sortField="",this.sortOrder="",this._item,this._field}return Object.defineProperty(e.prototype,"pageNumber",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._pageNumber=e,this}}),Object.defineProperty(e.prototype,"perPage",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.itemsPerPage=+e,this}}),Object.defineProperty(e.prototype,"everything",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.callEverything=!0,this}}),Object.defineProperty(e.prototype,"collection",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.nestedCollectionsIDs.push(e),this}}),Object.defineProperty(e.prototype,"item",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e)throw"item cant be "+e;if(this._item){if(this.nestedCollectionsIDs.length%2==0)throw"a nested item can only be placed after a nested collection";this.nestedCollectionsIDs.push(e)}else this._item=e;return this}}),Object.defineProperty(e.prototype,"query",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){if(!e)return this;Array.isArray(n)&&(n=n.join(","));var r=e+":"+t+":"+n;return this._query.push(encodeURIComponent(r)),this}}),Object.defineProperty(e.prototype,"sort",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return this.sortField=e,this.sortOrder=t||"",this}}),Object.defineProperty(e.prototype,"projectOn",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._projectOn=e,this}}),Object.defineProperty(e.prototype,"projectOff",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._projectOff=e,this}}),Object.defineProperty(e.prototype,"uploadImage",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r,i=this,o=t.selectedImage,a=t.imageLink,c=t.altText,s=t.fileName,u=new Function("try {return this===global;}catch(e){return false;}");if(u()){var l=n(941);r=new l}else r=new FormData;var b,h=this.nestedCollectionsIDs.join(".");return c&&r.append("altText",c),a?r.append("imageLink",a):r.append("imageFile",o,s),u()&&(b=r.getHeaders()),new Promise((function(t,n){var o="".concat(f,"/collection/").concat(i.collectionID,"/items/").concat(i._item,"/image?imageSlug=").concat(e,"&nestedID=").concat(h);i.instance.axiosInstance.put(o,r,{headers:b}).then((function(e){t(e)})).catch((function(e){return n(e)}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.nestedCollectionsIDs.join("."),n="".concat(f,"/collection/").concat(this.collectionID,"/items/").concat(this._item);return t&&(n+="?nestedID=".concat(t)),new Promise((function(t,r){e.instance.axiosInstance.delete(n).then((function(e){return t(e)})).catch((function(e){return r(e)}))}))}}),Object.defineProperty(e.prototype,"set",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,n=this.nestedCollectionsIDs.join("."),r="".concat(f,"/collection/").concat(this.collectionID,"/items/").concat(this._item,"?set=true");return n&&(r+="&nestedID=".concat(n)),new Promise((function(n,i){t.instance.axiosInstance.put(r,JSON.stringify(e)).then((function(e){return(0,o.__awaiter)(t,void 0,void 0,(function(){return(0,o.__generator)(this,(function(t){return n(e),[2]}))}))})).catch((function(e){return i(e)}))}))}}),Object.defineProperty(e.prototype,"put",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,n=this.nestedCollectionsIDs.join("."),r="".concat(f,"/collection/").concat(this.collectionID,"/items/").concat(this._item);return n&&(r+="?nestedID=".concat(n)),new Promise((function(n,i){t.instance.axiosInstance.put(r,JSON.stringify(e)).then((function(e){return(0,o.__awaiter)(t,void 0,void 0,(function(){return(0,o.__generator)(this,(function(t){return n(e),[2]}))}))})).catch((function(e){return i(e)}))}))}}),Object.defineProperty(e.prototype,"post",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,n=this.nestedCollectionsIDs.join(".");return new Promise((function(r,i){var o="".concat(f,"/collection/").concat(t.collectionID,"/items");n&&(o+="/".concat(t._item,"?nestedID=").concat(n)),t.instance.axiosInstance.post(o,e).then((function(e){r(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"append",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this,r=this.nestedCollectionsIDs.join(".");return new Promise((function(i,o){var a="".concat(f,"/collection/").concat(n.collectionID,"/items/").concat(n._item,"/field/").concat(e);r&&(a+="?nestedID=".concat(r)),n.instance.axiosInstance.put(a,{value:t}).then((function(e){i(e)})).catch((function(e){o(e)}))}))}}),Object.defineProperty(e.prototype,"field",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e||e.match(/\s/))throw"field slug cant be "+e;return this._field=e,this}}),Object.defineProperty(e.prototype,"increment",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!this._field)throw"field must be set to use the increment method";if(isNaN(parseFloat(e)))throw"Increment value must be a number";var n=this.nestedCollectionsIDs.join(".");return new Promise((function(r,i){var o="".concat(f,"/collection/").concat(t.collectionID,"/items/").concat(t._item,"/field/").concat(t._field,"?increment=").concat(e);n&&(o+="&nestedID=".concat(n)),t.instance.axiosInstance.put(o).then((function(e){r(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"decrement",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!this._field)throw"field must be set to use the decrement method";if("string"==typeof e&&(e=parseFloat(e)),isNaN(e))throw"Increment value must be a number";e>0&&(e*=-1);var n=this.nestedCollectionsIDs.join(".");return new Promise((function(r,i){var o="".concat(f,"/collection/").concat(t.collectionID,"/items/").concat(t._item,"/field/").concat(t._field,"?increment=").concat(e);n&&(o+="&nestedID=".concat(n)),t.instance.axiosInstance.put(o).then((function(e){r(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"unset",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this,r=this.nestedCollectionsIDs.join(".");if(r)throw"Unset is not yet supported in nested collections";return new Promise((function(i,o){var a="".concat(f,"/collection/").concat(n.collectionID,"/items/").concat(n._item,"/field/").concat(e);r&&(a+="?nestedID=".concat(r)),n.instance.axiosInstance.delete(a,{data:{value:t}}).then((function(e){i(e)})).catch((function(e){o(e)}))}))}}),Object.defineProperty(e.prototype,"value",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this,r=this.nestedCollectionsIDs.join(".");return new Promise((function(i,o){var a="".concat(f,"/collection/").concat(n.collectionID,"/items/").concat(n._item,"/field/").concat(e);r&&(a+="?nestedID=".concat(r)),n.instance.axiosInstance.delete(a,{data:{value:t}}).then((function(e){i(e)})).catch((function(e){o(e)}))}))}}),Object.defineProperty(e.prototype,"get",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;return new Promise((function(t,n){var r=new URLSearchParams,i=e.nestedCollectionsIDs.join(".");e._pageNumber&&r.append("pageNumber",String(e._pageNumber)),e.sortField&&r.append("sort",e.sortField),e.sortOrder&&r.append("order",e.sortOrder),e.itemsPerPage&&r.append("perPage",String(e.itemsPerPage)),e.callEverything&&r.append("everything",String(e.callEverything)),""!=e._projectOff&&r.append("projectOff",e._projectOff),""!=e._projectOn&&r.append("projectOn",e._projectOn);var o=e._item?"/"+e._item:"",a="".concat(f,"/collection/").concat(e.collectionID,"/items").concat(o,"?").concat(r.toString());e._query.length>0&&(a=a+"&query="+e._query.join("%2B")),i&&(a+="&nestedID=".concat(i)),e.instance.axiosInstance.get(a).then((function(e){e.status>=200&&e.status<400?t(e):n(e)})).catch((function(e){n(e)}))}))}}),Object.defineProperty(e.prototype,"users",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;if(!this._item)throw new Error("Users can only be retrieved in relation to an item");var t=this.nestedCollectionsIDs.join(".");return new Promise((function(n,r){var i="".concat(f,"/collection/").concat(e.collectionID,"/items/").concat(e._item,"/bagelUsers");t&&(i+="?nestedID=".concat(t)),e.instance.axiosInstance.get(i).then((function(e){n(e)})).catch((function(e){r(e)}))}))}}),Object.defineProperty(e.prototype,"addUser",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!this._item)throw new Error("Users can only be added in relation to an item");var n=this.nestedCollectionsIDs.join(".");return new Promise((function(r,i){var o="".concat(f,"/collection/").concat(t.collectionID,"/items/").concat(t._item,"/bagelUsers");n&&(o+="?nestedID=".concat(n)),t.instance.axiosInstance.put(o,{userID:e}).then((function(e){r(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"removeUser",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!this._item)throw new Error("Users can only be removed in relation to an item");var n=this.nestedCollectionsIDs.join(".");return new Promise((function(r,i){var o="".concat(f,"/collection/").concat(t.collectionID,"/items/").concat(t._item,"/bagelUsers");n&&(o+="?nestedID=".concat(n)),t.instance.axiosInstance.delete(o,{data:{userID:e}}).then((function(e){r(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"listen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function(){var n,r,i,a,c,s=this;return(0,o.__generator)(this,(function(u){switch(u.label){case 0:if(!e)throw new Error("onMessage callback must be defined");return[4,this.instance.users()._bagelUserActive()];case 1:return u.sent()?[4,this.instance.users()._getAccessToken()]:[3,3];case 2:return n=u.sent(),[3,4];case 3:n=this.apiToken,u.label=4;case 4:return r=this.nestedCollectionsIDs.join("."),i=b+"/collection/".concat(this.collectionID,"/live?authorization=").concat(n,"&nestedID=").concat(r,"&itemID=").concat(this._item),this.client=new EventSource(i),a=this,c=function(e){return(0,o.__awaiter)(s,void 0,void 0,(function(){var i;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return a.client.readyState!==EventSource.CLOSED?[3,4]:[4,a.instance.users()._bagelUserActive()];case 1:return o.sent()?[4,a.instance.users().refresh()]:[3,4];case 2:return o.sent(),[4,a.instance.users()._getAccessToken()];case 3:return n=o.sent(),i=b+"/collection/".concat(a.collectionID,"/live?authorization=").concat(n,"&requestID=").concat(a.requestID,"&nestedID=").concat(r,"&itemID=").concat(a._item),a.client=new EventSource(i),[2];case 4:return t&&t(e),[2]}}))}))},this.client.addEventListener("start",(function(e){a.requestID=e.data})),this.client.addEventListener("stop",(function(){return(0,o.__awaiter)(s,void 0,void 0,(function(){var t;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return[4,a.instance.users()._bagelUserActive()];case 1:return i.sent()?[4,a.instance.users()._getAccessToken()]:[3,3];case 2:return n=i.sent(),[3,4];case 3:n=a.apiToken,i.label=4;case 4:return a.client.close(),t=b+"/collection/".concat(a.collectionID,"/live?authorization=").concat(n,"&requestID=").concat(a.requestID,"&nestedID=").concat(r,"&itemID=").concat(a._item),a.client=new EventSource(t),a.client.onmessage=e,a.client.onerror=c,[2]}}))}))})),this.client.onmessage=e,this.client.onerror=c,[2,this.client]}}))}))}}),e}(),c=function(e){function t(t){var n=t.instance,r=t.collectionID;return e.call(this,{instance:n,collectionID:r})||this}return(0,o.__extends)(t,e),Object.defineProperty(t.prototype,"get",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;return new Promise((function(t,n){var r="".concat(f,"/collection/").concat(e.collectionID,"/schema");e.instance.axiosInstance.get(r).then((function(e){e.status>=200&&e.status<400?t(e):n(e)})).catch((function(e){n(e)}))}))}}),t}(a),s=require("lodash-es");var u="https://auth.bageldb.com/api/public";(null===globalThis||void 0===globalThis?void 0:globalThis.localStorage)||(globalThis.localStorage=new function(e){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"removeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clear",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__protected",{enumerable:!0,configurable:!0,writable:!0,value:void 0});var t=this;e||(e={});var n=(0,s.keys)(e),r=function(e){return(0,s.isUndefined)(e)?null:e};this.key=function(e){var t=n[e];return r(t)},this.setItem=function(r,i){(0,s.includes)(n,r)||n.push(r),e[r]=i,t.length=(0,s.size)(e)},this.getItem=function(t){var n=e[t];return r(n)},this.removeItem=function(r){delete e[r],n=(0,s.without)(n,r),t.length=(0,s.size)(e)},this.clear=function(){var t=(0,s.keys)(e),n=this.removeItem;t.forEach((function(e){n(e)}))},this.length=(0,s.size)(e),this.__protected=function(){return{data:e}}}({}));const l=function(){function e(e){var t,n=e.instance;Object.defineProperty(this,"instance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"axios",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bagelStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.instance=n,this.axios=this.instance.axiosInstance,this.bagelStorage=(null===(t=this.instance)||void 0===t?void 0:t.customStorage)||(null===globalThis||void 0===globalThis?void 0:globalThis.localStorage)}return Object.defineProperty(e.prototype,"_isBrowser",{enumerable:!1,configurable:!0,writable:!0,value:function(){return!new Function("try {return this===global;}catch(e){return false;}")()}}),Object.defineProperty(e.prototype,"_bagelUserActive",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:return e=this._isBrowser(),[4,this.getBagelUserID()];case 1:return t=n.sent(),[2,e&&null!==t&&t.length>0]}}))}))}}),Object.defineProperty(e.prototype,"create",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this;return e=e.toLowerCase().trim(),new Promise((function(r,i){var o="".concat(u,"/user"),a={email:e,password:t};n.axios.post(o,a).then((function(e){if(201==e.status){var t=e.data;if(n.instance.isServer)return void r(t.user_id);n._storeTokens(t),n._storeBagelUser(t.user_id),r(t.user_id)}else i(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"validateOtp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,o.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this._getOtpRequestNonce()];case 1:t=o.sent(),n="".concat(u,"/user/otp/verify/").concat(t),r={otp:e},o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.axios.post(n,r)];case 3:return i=o.sent(),this._storeTokens(i.data),[2,i.data.user_id];case 4:throw o.sent(),"wrong authorization code";case 5:return[2]}}))}))}}),Object.defineProperty(e.prototype,"_getOtpRequestNonce",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.bagelStorage.getItem("bagel-nonce")];case 1:return e=r.sent(),[4,this.bagelStorage.getItem("bagel-expires")];case 2:if(t=+(r.sent()||""),e&&t){if(n=new Date,t<=n.setSeconds(n.getSeconds()))throw"OTP request has expired, try again";return[2,e]}throw"Request an OTP first"}}))}))}}),Object.defineProperty(e.prototype,"requestOtp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,o.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:e=e.toLowerCase().trim(),t="".concat(u,"/user/otp"),n={emailOrPhone:e},i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.axios.post(t,n)];case 2:return r=i.sent(),[4,this._storeOtpRequestNonce(r.data)];case 3:return i.sent(),[2,r.data.nonce];case 4:return[2,i.sent()];case 5:return[2]}}))}))}}),Object.defineProperty(e.prototype,"_storeOtpRequestNonce",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.nonce,n=e.expires_in;return(0,o.__awaiter)(this,void 0,void 0,(function(){var e,r;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return e=new Date,r="".concat(e.setSeconds(e.getSeconds()+n)),[4,this.bagelStorage.setItem("bagel-nonce",t)];case 1:return i.sent(),[4,this.bagelStorage.setItem("bagel-expires",r)];case 2:return i.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this;return e=e.toLowerCase().trim(),new Promise((function(r,i){var o="".concat(u,"/user/verify"),a={email:e,password:t};n.axios.post(o,a).then((function(e){if(200==e.status){var t=e.data;n._storeTokens(t),n._storeBagelUser(t.user_id),r(t.user_id)}else i(e)})).catch((function(e){i(e)}))}))}}),Object.defineProperty(e.prototype,"getUser",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;return new Promise((function(t,n){if(e._bagelUserActive()){var r="".concat(u,"/user");e.axios.get(r).then((function(e){200==e.status?t(e):n(e)})).catch((function(e){n(e)}))}else n(new Error("a Bagel User must be logged in to get Bagel User info"+e._bagelUserActive()))}))}}),Object.defineProperty(e.prototype,"requestPasswordReset",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return e=e.toLowerCase().trim(),new Promise((function(n,r){var i="".concat(u,"/user/resetpassword"),o={email:e};t.axios.post(i,o).then((function(e){200==e.status?n(e):r(e)})).catch((function(e){r(e)}))}))}}),Object.defineProperty(e.prototype,"updatePassword",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this;return e=e.toLowerCase().trim(),new Promise((function(r,i){if(n._isBrowser())i(new Error("Update Password feature is only available when using NodeJS"));else{var o="".concat(u,"/user/updatePassword"),a={email:e,password:t};n.axios.post(o,a).then((function(e){200==e.status?r(e):i(e)})).catch((function(e){i(e)}))}}))}}),Object.defineProperty(e.prototype,"_storeBagelUser",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,o.__awaiter)(this,void 0,void 0,(function(){return(0,o.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.bagelStorage.setItem("bagel-user",e)];case 1:return t.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"_storeTokens",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,o.__awaiter)(this,void 0,void 0,(function(){var t;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.bagelStorage.setItem("bagel-access",e.access_token)];case 1:return n.sent(),(t=new Date).setSeconds(t.getSeconds()+e.expires_in),[4,this.bagelStorage.setItem("bagel-expires",t)];case 2:return n.sent(),[4,this.bagelStorage.setItem("bagel-refresh",e.refresh_token)];case 3:return n.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"getBagelUserID",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.bagelStorage.getItem("bagel-user")];case 1:return[2,e.sent()]}}))}))}}),Object.defineProperty(e.prototype,"_getRefreshToken",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.bagelStorage.getItem("bagel-refresh")];case 1:return[2,e.sent()]}}))}))}}),Object.defineProperty(e.prototype,"_getAccessToken",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){var e;return(0,o.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.bagelStorage.getItem("bagel-expires")];case 1:return e=t.sent()||"",new Date(e)<=new Date?[2,this.refresh()]:[3,2];case 2:return[4,this.bagelStorage.getItem("bagel-access")];case 3:return[2,t.sent()]}}))}))}}),Object.defineProperty(e.prototype,"logout",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.bagelStorage.removeItem("bagel-user")];case 1:return e.sent(),[4,this.bagelStorage.removeItem("bagel-access")];case 2:return e.sent(),[4,this.bagelStorage.removeItem("bagel-refresh")];case 3:return e.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"refresh",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;return new Promise((function(t,n){if(e._getRefreshToken()){var r="".concat(u,"/user/token"),i="grant_type=refresh_token&refresh_token=".concat(e._getRefreshToken(),"&client_id=project-client");e.axios.post(r,i).then((function(r){if(200===r.status){var i=r.data;e._storeTokens(i),t(i.access_token)}else n(r)})).catch((function(e){n(e)}))}else n(new Error("No Bagel User is logged in"))}))}}),e}();var f="https://api.bagelstudio.co/api/public",b="https://live.bageldb.com/api/public"},465:(e,t,n)=>{n.d(t,{default:()=>o});var r=n(752),i=n(454);const o=function(){function e(e,t){void 0===t&&(t={isServer:!1,customStorage:void 0});var n=this;Object.defineProperty(this,"isServer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"customStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiToken",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"axiosInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isServer=!!t.isServer,this.customStorage=t.customStorage,this.apiToken=e,this.axiosInstance=i.od.create(),this.axiosInstance.interceptors.request.use((function(t){return(0,r.__awaiter)(n,void 0,void 0,(function(){var n,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t.headers["Accept-Version"]="v1",[4,new i.NR({instance:this})._bagelUserActive()];case 1:return r.sent()&&!(null===(o=t.url)||void 0===o?void 0:o.includes("user/token"))?(n=new i.NR({instance:this})._getAccessToken(),t.headers.Authorization="Bearer "+n):t.headers.Authorization="Bearer "+e,[2,t]}}))}))}),(function(e){return Promise.reject(e)})),this.axiosInstance.interceptors.response.use((function(e){return e}),(function(e){return(0,r.__awaiter)(n,void 0,void 0,(function(){var t=this;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,new i.NR({instance:this})._bagelUserActive()];case 1:return n.sent()&&e.response&&401==e.response.status&&!e.config.url.includes("user/token")?[2,new i.NR({instance:this}).refresh().then((function(){var n=e.config;return n.headers.Authorization="Bearer ".concat(new i.NR({instance:t})._getAccessToken()),new Promise((function(e,t){i.od.request(n).then((function(t){e(t)})).catch((function(e){t(e)}))}))})).catch((function(){return Promise.reject(e)}))]:[2,Promise.reject(e)]}}))}))}))}return Object.defineProperty(e.prototype,"schema",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return new i.ej({instance:this,collectionID:e})}}),Object.defineProperty(e.prototype,"collection",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return new i.CH({instance:this,collectionID:e})}}),Object.defineProperty(e.prototype,"users",{enumerable:!1,configurable:!0,writable:!0,value:function(){return new i.NR({instance:this})}}),Object.defineProperty(e,"ASC",{get:function(){return"ASC"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DESC",{get:function(){return"DESC"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EQUAL",{get:function(){return"="},enumerable:!1,configurable:!0}),Object.defineProperty(e,"NOT_EQUAL",{get:function(){return"!="},enumerable:!1,configurable:!0}),Object.defineProperty(e,"GREATER_THAN",{get:function(){return">"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LESS_THAN",{get:function(){return"<"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WITHIN",{get:function(){return"within"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"GeoPointQuery",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}}),e}()},941:e=>{e.exports=require("form-data")},752:e=>{e.exports=require("tslib")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{BagelDB:()=>e.default,BagelDBRequest:()=>t.CH,BagelMetaRequest:()=>t.ej,BagelUsersRequest:()=>t.NR});var e=n(465),t=n(454)})(),exports.BagelDB=r.BagelDB,exports.BagelDBRequest=r.BagelDBRequest,exports.BagelMetaRequest=r.BagelMetaRequest,exports.BagelUsersRequest=r.BagelUsersRequest,Object.defineProperty(exports,"__esModule",{value:!0})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFlQyxLQUFLSixFQUFLQyxHQ0NsRmYsRUFBb0JtQixFQUFLckIsSUFDSCxvQkFBWHNCLFFBQTBCQSxPQUFPQyxhQUMxQ1YsT0FBT0MsZUFBZWQsRUFBU3NCLE9BQU9DLFlBQWEsQ0FBRWxLLE1BQU8sV0FFN0R3SixPQUFPQyxlQUFlZCxFQUFTLGFBQWMsQ0FBRTNJLE9BQU8sSyIsInNvdXJjZXMiOlsid2VicGFjazovL0BiYWdlbGRiL2JhZ2VsLWRiL2V4dGVybmFsIGNvbW1vbmpzIFwiYXhpb3NcIiIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi8uL3NyYy9iYWdlbERCUmVxdWVzdC50cyIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi8uL3NyYy9iYWdlbE1ldGFSZXF1ZXN0LnRzIiwid2VicGFjazovL0BiYWdlbGRiL2JhZ2VsLWRiL2V4dGVybmFsIGNvbW1vbmpzIFwibG9kYXNoLWVzXCIiLCJ3ZWJwYWNrOi8vQGJhZ2VsZGIvYmFnZWwtZGIvLi9zcmMvdXNlcnMudHMiLCJ3ZWJwYWNrOi8vQGJhZ2VsZGIvYmFnZWwtZGIvLi9zcmMvZmJTdG9yYWdlLnRzIiwid2VicGFjazovL0BiYWdlbGRiL2JhZ2VsLWRiLy4vc3JjL2NvbW1vbi50cyIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi9leHRlcm5hbCBjb21tb25qcyBcImZvcm0tZGF0YVwiIiwid2VicGFjazovL0BiYWdlbGRiL2JhZ2VsLWRiL2V4dGVybmFsIGNvbW1vbmpzIFwidHNsaWJcIiIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQGJhZ2VsZGIvYmFnZWwtZGIvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9AYmFnZWxkYi9iYWdlbC1kYi93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiYXhpb3NcIik7IiwiaW1wb3J0IHsgQXhpb3NJbnN0YW5jZSwgQXhpb3NQcm9taXNlLCBBeGlvc1Jlc3BvbnNlIH0gZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgeyBheGlvcyB9IGZyb20gXCIuL2NvbW1vblwiO1xuaW1wb3J0IHsgYmFzZUVuZHBvaW50LCBsaXZlRW5kcG9pbnQgfSBmcm9tIFwiLi9jb21tb25cIjtcbmltcG9ydCB7IGJhZ2VsVHlwZSwgZmlsZVVwbG9hZEFyZ3MsIHN0cnVjdEFyZ3MgfSBmcm9tIFwiLi9pbnRlcmZhY2VzXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCYWdlbERCUmVxdWVzdCB7XG4gIGluc3RhbmNlOiBiYWdlbFR5cGU7XG4gIGNvbGxlY3Rpb25JRDogc3RyaW5nO1xuICBfcGFnZU51bWJlcjogbnVtYmVyO1xuICBpdGVtc1BlclBhZ2U6IG51bWJlcjtcbiAgY2FsbEV2ZXJ5dGhpbmc6IGJvb2xlYW47XG4gIF9xdWVyeTogYW55W107XG4gIG5lc3RlZENvbGxlY3Rpb25zSURzOiBhbnlbXTtcbiAgYXhpb3NJbnN0YW5jZTogQXhpb3NJbnN0YW5jZTtcbiAgYXBpVG9rZW46IHN0cmluZztcbiAgX3Byb2plY3RPbjogc3RyaW5nO1xuICBfcHJvamVjdE9mZjogc3RyaW5nO1xuICByZXF1ZXN0SUQ6IHN0cmluZztcbiAgY2xpZW50ITogRXZlbnRTb3VyY2U7XG4gIF9pdGVtOiBhbnk7XG4gIF9maWVsZDogYW55O1xuICBzb3J0RmllbGQ6IHN0cmluZztcbiAgc29ydE9yZGVyOiBzdHJpbmc7XG4gIFt4OiBzdHJpbmddOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoeyBpbnN0YW5jZSwgY29sbGVjdGlvbklEIH06IHN0cnVjdEFyZ3MpIHtcbiAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgdGhpcy5jb2xsZWN0aW9uSUQgPSBjb2xsZWN0aW9uSUQ7XG4gICAgdGhpcy5fcGFnZU51bWJlciA9IDE7XG4gICAgdGhpcy5pdGVtc1BlclBhZ2UgPSAxMDA7XG4gICAgdGhpcy5jYWxsRXZlcnl0aGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX3F1ZXJ5ID0gW107XG4gICAgdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcyA9IFtdO1xuICAgIHRoaXMuYXhpb3NJbnN0YW5jZSA9IGF4aW9zLmNyZWF0ZSgpO1xuICAgIHRoaXMuYXBpVG9rZW4gPSBpbnN0YW5jZS5hcGlUb2tlbjtcbiAgICB0aGlzLl9wcm9qZWN0T24gPSBcIlwiO1xuICAgIHRoaXMuX3Byb2plY3RPZmYgPSBcIlwiO1xuICAgIHRoaXMucmVxdWVzdElEID0gXCJcIjtcbiAgICB0aGlzLnNvcnRGaWVsZCA9IFwiXCI7XG4gICAgdGhpcy5zb3J0T3JkZXIgPSBcIlwiO1xuICAgIC8vIHRoaXMuY2xpZW50O1xuICAgIHRoaXMuX2l0ZW07XG4gICAgdGhpcy5fZmllbGQ7XG4gIH1cbiAgLy8gUGFnaW5hdGlvblxuICBwYWdlTnVtYmVyKHBhZ2VOdW1iZXIpIHtcbiAgICB0aGlzLl9wYWdlTnVtYmVyID0gcGFnZU51bWJlcjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHBlclBhZ2UocGVyUGFnZTogbnVtYmVyIHwgc3RyaW5nKSB7XG4gICAgdGhpcy5pdGVtc1BlclBhZ2UgPSArcGVyUGFnZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGV2ZXJ5dGhpbmcoKSB7XG4gICAgdGhpcy5jYWxsRXZlcnl0aGluZyA9IHRydWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjb2xsZWN0aW9uKGNvbGxlY3Rpb25TbHVnKSB7XG4gICAgdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5wdXNoKGNvbGxlY3Rpb25TbHVnKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGl0ZW0oX2lkKSB7XG4gICAgaWYgKCFfaWQpIHRocm93IFwiaXRlbSBjYW50IGJlIFwiICsgX2lkO1xuICAgIGlmICh0aGlzLl9pdGVtKSB7XG4gICAgICBpZiAodGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5sZW5ndGggJSAyID09PSAwKVxuICAgICAgICB0aHJvdyBcImEgbmVzdGVkIGl0ZW0gY2FuIG9ubHkgYmUgcGxhY2VkIGFmdGVyIGEgbmVzdGVkIGNvbGxlY3Rpb25cIjtcbiAgICAgIHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMucHVzaChfaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9pdGVtID0gX2lkO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHF1ZXJ5KGtleSwgb3BlcmF0b3IsIHZhbHVlKSB7XG4gICAgaWYgKCFrZXkpIHJldHVybiB0aGlzO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgdmFsdWUgPSB2YWx1ZS5qb2luKFwiLFwiKTtcbiAgICBjb25zdCBxdWVyeSA9IGtleSArIFwiOlwiICsgb3BlcmF0b3IgKyBcIjpcIiArIHZhbHVlO1xuICAgIHRoaXMuX3F1ZXJ5LnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzb3J0KGZpZWxkLCBvcmRlcikge1xuICAgIHRoaXMuc29ydEZpZWxkID0gZmllbGQ7XG4gICAgdGhpcy5zb3J0T3JkZXIgPSBvcmRlciB8fCBcIlwiO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHJvamVjdE9uKHNsdWdzKSB7XG4gICAgdGhpcy5fcHJvamVjdE9uID0gc2x1Z3M7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcm9qZWN0T2ZmKHNsdWdzKSB7XG4gICAgdGhpcy5fcHJvamVjdE9mZiA9IHNsdWdzO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLy8gRWl0aGVyIG9mIGltYWdlTGluayBvciBzZWxlY3RlZEltYWdlIG11c3QgYmUgdXNlZFxuICAvLyBzZWxlY3RlZEltYWdlIGV4cGVjdHMgYSBmaWxlIHN0cmVhbSBpLmUgZnMuY3JlYXRlUmVhZFN0cmVhbShmaWxlbmFtZSlcbiAgdXBsb2FkSW1hZ2UoaW1hZ2VTbHVnOiBzdHJpbmcsIHsgc2VsZWN0ZWRJbWFnZSwgaW1hZ2VMaW5rLCBhbHRUZXh0LCBmaWxlTmFtZSB9OiBmaWxlVXBsb2FkQXJncyk6IEF4aW9zUHJvbWlzZSB7XG4gICAgY29uc3QgaXNOb2RlID0gbmV3IEZ1bmN0aW9uKFwidHJ5IHtyZXR1cm4gdGhpcz09PWdsb2JhbDt9Y2F0Y2goZSl7cmV0dXJuIGZhbHNlO31cIik7XG4gICAgbGV0IGZvcm07XG4gICAgaWYgKGlzTm9kZSgpKSB7XG4gICAgICBjb25zdCBGb3JtRGF0YSA9IHJlcXVpcmUoJ2Zvcm0tZGF0YScpO1xuXHRcdFx0Zm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgfVxuICAgIGNvbnN0IG5lc3RlZElEID0gdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5qb2luKFwiLlwiKTtcbiAgICBpZiAoYWx0VGV4dCkge1xuICAgICAgZm9ybS5hcHBlbmQoXCJhbHRUZXh0XCIsIGFsdFRleHQpO1xuICAgIH1cbiAgICBpZiAoaW1hZ2VMaW5rKSB7XG4gICAgICBmb3JtLmFwcGVuZChcImltYWdlTGlua1wiLCBpbWFnZUxpbmspO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3JtLmFwcGVuZChcImltYWdlRmlsZVwiLCBzZWxlY3RlZEltYWdlLCBmaWxlTmFtZSk7XG4gICAgfVxuICAgIGxldCBmb3JtSGVhZGVycztcbiAgICBpZiAoaXNOb2RlKCkpIHtcbiAgICAgIGZvcm1IZWFkZXJzID0gZm9ybS5nZXRIZWFkZXJzKCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCB1cmwgPSBgJHtiYXNlRW5kcG9pbnR9L2NvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25JRH0vaXRlbXMvJHt0aGlzLl9pdGVtfS9pbWFnZT9pbWFnZVNsdWc9JHtpbWFnZVNsdWd9Jm5lc3RlZElEPSR7bmVzdGVkSUR9YDtcbiAgICAgIHRoaXMuaW5zdGFuY2UuYXhpb3NJbnN0YW5jZVxuICAgICAgICAucHV0KHVybCwgZm9ybSwgeyBoZWFkZXJzOiBmb3JtSGVhZGVycyB9KVxuICAgICAgICAudGhlbigoaW1nUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICByZXNvbHZlKGltZ1Jlc3BvbnNlKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHJlamVjdChlcnIpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZSgpIHtcbiAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgbGV0IHVybCA9IGAke2Jhc2VFbmRwb2ludH0vY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbklEfS9pdGVtcy8ke3RoaXMuX2l0ZW19YDtcbiAgICBpZiAobmVzdGVkSUQpIHVybCA9IHVybCArIGA/bmVzdGVkSUQ9JHtuZXN0ZWRJRH1gO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLmRlbGV0ZSh1cmwpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHJlc29sdmUocmVzKSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHJlamVjdChlcnIpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldChkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgbGV0IHVybCA9IGAke2Jhc2VFbmRwb2ludH0vY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbklEfS9pdGVtcy8ke3RoaXMuX2l0ZW19P3NldD10cnVlYDtcbiAgICBpZiAobmVzdGVkSUQpIHVybCA9IHVybCArIGAmbmVzdGVkSUQ9JHtuZXN0ZWRJRH1gO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLnB1dCh1cmwsIEpTT04uc3RyaW5naWZ5KGRhdGEpKVxuICAgICAgICAudGhlbihhc3luYyAocmVzKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4gcmVqZWN0KGVycikpO1xuICAgIH0pO1xuICB9XG5cbiAgcHV0KGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBBeGlvc1Byb21pc2Uge1xuICAgIGNvbnN0IG5lc3RlZElEID0gdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5qb2luKFwiLlwiKTtcbiAgICBsZXQgdXJsID0gYCR7YmFzZUVuZHBvaW50fS9jb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uSUR9L2l0ZW1zLyR7dGhpcy5faXRlbX1gO1xuICAgIGlmIChuZXN0ZWRJRCkgdXJsID0gdXJsICsgYD9uZXN0ZWRJRD0ke25lc3RlZElEfWA7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuaW5zdGFuY2UuYXhpb3NJbnN0YW5jZVxuICAgICAgICAucHV0KHVybCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpXG4gICAgICAgIC50aGVuKGFzeW5jIChyZXMpID0+IHtcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiByZWplY3QoZXJyKSk7XG4gICAgfSk7XG4gIH1cblxuICBwb3N0KGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBBeGlvc1Byb21pc2Uge1xuICAgIGNvbnN0IG5lc3RlZElEID0gdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5qb2luKFwiLlwiKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IHVybCA9IGAke2Jhc2VFbmRwb2ludH0vY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbklEfS9pdGVtc2A7XG4gICAgICBpZiAobmVzdGVkSUQpIHVybCA9IHVybCArIGAvJHt0aGlzLl9pdGVtfT9uZXN0ZWRJRD0ke25lc3RlZElEfWA7XG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLnBvc3QodXJsLCBkYXRhKVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBhcHBlbmQoZmllbGRTbHVnLCB2YWx1ZSk6IEF4aW9zUHJvbWlzZSB7XG4gICAgY29uc3QgbmVzdGVkSUQgPSB0aGlzLm5lc3RlZENvbGxlY3Rpb25zSURzLmpvaW4oXCIuXCIpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgdXJsID0gYCR7YmFzZUVuZHBvaW50fS9jb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uSUR9L2l0ZW1zLyR7dGhpcy5faXRlbX0vZmllbGQvJHtmaWVsZFNsdWd9YDtcbiAgICAgIGlmIChuZXN0ZWRJRCkgdXJsID0gdXJsICsgYD9uZXN0ZWRJRD0ke25lc3RlZElEfWA7XG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLnB1dCh1cmwsIHsgdmFsdWU6IHZhbHVlIH0pXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZpZWxkKGZpZWxkU2x1Zykge1xuICAgIGlmICghZmllbGRTbHVnIHx8IGZpZWxkU2x1Zy5tYXRjaCgvXFxzLykpIHRocm93IFwiZmllbGQgc2x1ZyBjYW50IGJlIFwiICsgZmllbGRTbHVnO1xuICAgIHRoaXMuX2ZpZWxkID0gZmllbGRTbHVnO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5jcmVtZW50KGluY3JlbWVudFZhbHVlKTogQXhpb3NQcm9taXNlIHtcbiAgICBpZiAoIXRoaXMuX2ZpZWxkKSB0aHJvdyBcImZpZWxkIG11c3QgYmUgc2V0IHRvIHVzZSB0aGUgaW5jcmVtZW50IG1ldGhvZFwiO1xuICAgIGlmIChpc05hTihwYXJzZUZsb2F0KGluY3JlbWVudFZhbHVlKSkpIHRocm93IFwiSW5jcmVtZW50IHZhbHVlIG11c3QgYmUgYSBudW1iZXJcIjtcbiAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGxldCB1cmwgPSBgJHtiYXNlRW5kcG9pbnR9L2NvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25JRH0vaXRlbXMvJHt0aGlzLl9pdGVtfS9maWVsZC8ke3RoaXMuX2ZpZWxkfT9pbmNyZW1lbnQ9JHtpbmNyZW1lbnRWYWx1ZX1gO1xuICAgICAgaWYgKG5lc3RlZElEKSB1cmwgPSB1cmwgKyBgJm5lc3RlZElEPSR7bmVzdGVkSUR9YDtcbiAgICAgIHRoaXMuaW5zdGFuY2UuYXhpb3NJbnN0YW5jZVxuICAgICAgICAucHV0KHVybClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZGVjcmVtZW50KGRlY3JlbWVudFZhbHVlKTogQXhpb3NQcm9taXNlIHtcbiAgICBpZiAoIXRoaXMuX2ZpZWxkKSB0aHJvdyBcImZpZWxkIG11c3QgYmUgc2V0IHRvIHVzZSB0aGUgZGVjcmVtZW50IG1ldGhvZFwiO1xuICAgIGlmICh0eXBlb2YgZGVjcmVtZW50VmFsdWUgPT0gXCJzdHJpbmdcIikgZGVjcmVtZW50VmFsdWUgPSBwYXJzZUZsb2F0KGRlY3JlbWVudFZhbHVlKTtcbiAgICBpZiAoaXNOYU4oZGVjcmVtZW50VmFsdWUpKSB0aHJvdyBcIkluY3JlbWVudCB2YWx1ZSBtdXN0IGJlIGEgbnVtYmVyXCI7XG4gICAgaWYgKGRlY3JlbWVudFZhbHVlID4gMCkgZGVjcmVtZW50VmFsdWUgPSBkZWNyZW1lbnRWYWx1ZSAqIC0xO1xuICAgIGNvbnN0IG5lc3RlZElEID0gdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5qb2luKFwiLlwiKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IHVybCA9IGAke2Jhc2VFbmRwb2ludH0vY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbklEfS9pdGVtcy8ke3RoaXMuX2l0ZW19L2ZpZWxkLyR7dGhpcy5fZmllbGR9P2luY3JlbWVudD0ke2RlY3JlbWVudFZhbHVlfWA7XG4gICAgICBpZiAobmVzdGVkSUQpIHVybCA9IHVybCArIGAmbmVzdGVkSUQ9JHtuZXN0ZWRJRH1gO1xuICAgICAgdGhpcy5pbnN0YW5jZS5heGlvc0luc3RhbmNlXG4gICAgICAgIC5wdXQodXJsKVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICB1bnNldChmaWVsZFNsdWcsIHZhbHVlKTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgaWYgKG5lc3RlZElEKSB0aHJvdyBcIlVuc2V0IGlzIG5vdCB5ZXQgc3VwcG9ydGVkIGluIG5lc3RlZCBjb2xsZWN0aW9uc1wiO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgdXJsID0gYCR7YmFzZUVuZHBvaW50fS9jb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uSUR9L2l0ZW1zLyR7dGhpcy5faXRlbX0vZmllbGQvJHtmaWVsZFNsdWd9YDtcbiAgICAgIGlmIChuZXN0ZWRJRCkgdXJsID0gdXJsICsgYD9uZXN0ZWRJRD0ke25lc3RlZElEfWA7XG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLmRlbGV0ZSh1cmwsIHsgZGF0YTogeyB2YWx1ZTogdmFsdWUgfSB9KVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICB2YWx1ZShmaWVsZFNsdWcsIHZhbHVlKTogQXhpb3NQcm9taXNlIHtcbiAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGxldCB1cmwgPSBgJHtiYXNlRW5kcG9pbnR9L2NvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25JRH0vaXRlbXMvJHt0aGlzLl9pdGVtfS9maWVsZC8ke2ZpZWxkU2x1Z31gO1xuICAgICAgaWYgKG5lc3RlZElEKSB1cmwgPSB1cmwgKyBgP25lc3RlZElEPSR7bmVzdGVkSUR9YDtcbiAgICAgIHRoaXMuaW5zdGFuY2UuYXhpb3NJbnN0YW5jZVxuICAgICAgICAuZGVsZXRlKHVybCwgeyBkYXRhOiB7IHZhbHVlOiB2YWx1ZSB9IH0pXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldCgpOiBBeGlvc1Byb21pc2Uge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgICB0aGlzLl9wYWdlTnVtYmVyICYmIHBhcmFtcy5hcHBlbmQoXCJwYWdlTnVtYmVyXCIsIFN0cmluZyh0aGlzLl9wYWdlTnVtYmVyKSk7XG4gICAgICB0aGlzLnNvcnRGaWVsZCAmJiBwYXJhbXMuYXBwZW5kKFwic29ydFwiLCB0aGlzLnNvcnRGaWVsZCk7XG4gICAgICB0aGlzLnNvcnRPcmRlciAmJiBwYXJhbXMuYXBwZW5kKFwib3JkZXJcIiwgdGhpcy5zb3J0T3JkZXIpO1xuICAgICAgdGhpcy5pdGVtc1BlclBhZ2UgJiYgcGFyYW1zLmFwcGVuZChcInBlclBhZ2VcIiwgU3RyaW5nKHRoaXMuaXRlbXNQZXJQYWdlKSk7XG4gICAgICB0aGlzLmNhbGxFdmVyeXRoaW5nICYmIHBhcmFtcy5hcHBlbmQoXCJldmVyeXRoaW5nXCIsIFN0cmluZyh0aGlzLmNhbGxFdmVyeXRoaW5nKSk7XG4gICAgICB0aGlzLl9wcm9qZWN0T2ZmICE9IFwiXCIgJiYgcGFyYW1zLmFwcGVuZChcInByb2plY3RPZmZcIiwgdGhpcy5fcHJvamVjdE9mZik7XG4gICAgICB0aGlzLl9wcm9qZWN0T24gIT0gXCJcIiAmJiBwYXJhbXMuYXBwZW5kKFwicHJvamVjdE9uXCIsIHRoaXMuX3Byb2plY3RPbik7XG5cbiAgICAgIGNvbnN0IGl0ZW1JRCA9IHRoaXMuX2l0ZW0gPyBcIi9cIiArIHRoaXMuX2l0ZW0gOiBcIlwiO1xuXG4gICAgICBsZXQgdXJsID0gYCR7YmFzZUVuZHBvaW50fS9jb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uSUR9L2l0ZW1zJHtpdGVtSUR9PyR7cGFyYW1zLnRvU3RyaW5nKCl9YDtcbiAgICAgIGlmICh0aGlzLl9xdWVyeS5sZW5ndGggPiAwKSB1cmwgPSB1cmwgKyBcIiZxdWVyeT1cIiArIHRoaXMuX3F1ZXJ5LmpvaW4oXCIlMkJcIik7XG4gICAgICBpZiAobmVzdGVkSUQpIHVybCA9IHVybCArIGAmbmVzdGVkSUQ9JHtuZXN0ZWRJRH1gO1xuXG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLmdldCh1cmwpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA+PSAyMDAgJiYgcmVzLnN0YXR1cyA8IDQwMCkge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWplY3QocmVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgdXNlcnMoKTogQXhpb3NQcm9taXNlIHtcbiAgICBpZiAoIXRoaXMuX2l0ZW0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXJzIGNhbiBvbmx5IGJlIHJldHJpZXZlZCBpbiByZWxhdGlvbiB0byBhbiBpdGVtXCIpO1xuICAgIH1cbiAgICBjb25zdCBuZXN0ZWRJRCA9IHRoaXMubmVzdGVkQ29sbGVjdGlvbnNJRHMuam9pbihcIi5cIik7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGxldCB1cmwgPSBgJHtiYXNlRW5kcG9pbnR9L2NvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25JRH0vaXRlbXMvJHt0aGlzLl9pdGVtfS9iYWdlbFVzZXJzYDtcbiAgICAgIGlmIChuZXN0ZWRJRCkgdXJsID0gdXJsICsgYD9uZXN0ZWRJRD0ke25lc3RlZElEfWA7XG4gICAgICB0aGlzLmluc3RhbmNlLmF4aW9zSW5zdGFuY2VcbiAgICAgICAgLmdldCh1cmwpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZFVzZXIoYmFnZWxVc2VySUQpOiBBeGlvc1Byb21pc2Uge1xuICAgIGlmICghdGhpcy5faXRlbSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVXNlcnMgY2FuIG9ubHkgYmUgYWRkZWQgaW4gcmVsYXRpb24gdG8gYW4gaXRlbVwiKTtcbiAgICB9XG4gICAgY29uc3QgbmVzdGVkSUQgPSB0aGlzLm5lc3RlZENvbGxlY3Rpb25zSURzLmpvaW4oXCIuXCIpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgdXJsID0gYCR7YmFzZUVuZHBvaW50fS9jb2xsZWN0aW9uLyR7dGhpcy5jb2xsZWN0aW9uSUR9L2l0ZW1zLyR7dGhpcy5faXRlbX0vYmFnZWxVc2Vyc2A7XG4gICAgICBpZiAobmVzdGVkSUQpIHVybCA9IHVybCArIGA/bmVzdGVkSUQ9JHtuZXN0ZWRJRH1gO1xuICAgICAgdGhpcy5pbnN0YW5jZS5heGlvc0luc3RhbmNlXG4gICAgICAgIC5wdXQodXJsLCB7IHVzZXJJRDogYmFnZWxVc2VySUQgfSlcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlVXNlcihiYWdlbFVzZXJJRCk6IEF4aW9zUHJvbWlzZSB7XG4gICAgaWYgKCF0aGlzLl9pdGVtKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVc2VycyBjYW4gb25seSBiZSByZW1vdmVkIGluIHJlbGF0aW9uIHRvIGFuIGl0ZW1cIik7XG4gICAgfVxuICAgIGNvbnN0IG5lc3RlZElEID0gdGhpcy5uZXN0ZWRDb2xsZWN0aW9uc0lEcy5qb2luKFwiLlwiKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IHVybCA9IGAke2Jhc2VFbmRwb2ludH0vY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbklEfS9pdGVtcy8ke3RoaXMuX2l0ZW19L2JhZ2VsVXNlcnNgO1xuICAgICAgaWYgKG5lc3RlZElEKSB1cmwgPSB1cmwgKyBgP25lc3RlZElEPSR7bmVzdGVkSUR9YDtcbiAgICAgIHRoaXMuaW5zdGFuY2UuYXhpb3NJbnN0YW5jZVxuICAgICAgICAuZGVsZXRlKHVybCwgeyBkYXRhOiB7IHVzZXJJRDogYmFnZWxVc2VySUQgfSB9KVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBDbGllbnQgaXMgcmV0dXJuZWQuIEl0IG11c3QgYmUgY2xvc2VkIHdoZW4gaXQgaXMgbm8gbG9uZ2VyIHJlcXVpcmVkIHVzaW5nIGNsaWVudC5jbG9zZSgpXG4gIC8vIG9ubWVzc2FnZSBhbmQgb25lcnJvciBhcmUgY2FsbGJhY2sgZnVuY3Rpb25zIHRvIHByb2Nlc3MgdGhlIGRhdGFcbiAgLy8gc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FdmVudFNvdXJjZSBmb3IgbW9yZSBpbmZvIG9uIFNlcnZlciBTaWRlIEV2ZW50cyAoU1NFKVxuICBhc3luYyBsaXN0ZW4ob25tZXNzYWdlOiAoLi4uYXJnczogYW55KSA9PiB1bmtub3duLCBvbmVycm9yOiAoLi4uYXJnczogYW55KSA9PiB1bmtub3duKSB7XG4gICAgaWYgKCFvbm1lc3NhZ2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIm9uTWVzc2FnZSBjYWxsYmFjayBtdXN0IGJlIGRlZmluZWRcIik7XG4gICAgfVxuXG4gICAgbGV0IHRva2VuOiBzdHJpbmcgfCBudWxsIHwgQXhpb3NSZXNwb25zZTxzdHJpbmcsIGFueT47XG4gICAgaWYgKGF3YWl0IHRoaXMuaW5zdGFuY2UudXNlcnMoKS5fYmFnZWxVc2VyQWN0aXZlKCkpIHRva2VuID0gYXdhaXQgdGhpcy5pbnN0YW5jZS51c2VycygpLl9nZXRBY2Nlc3NUb2tlbigpO1xuICAgIGVsc2UgdG9rZW4gPSB0aGlzLmFwaVRva2VuO1xuXG4gICAgY29uc3QgbmVzdGVkSUQgPSB0aGlzLm5lc3RlZENvbGxlY3Rpb25zSURzLmpvaW4oXCIuXCIpO1xuXG4gICAgY29uc3QgdXJsID1cbiAgICAgIGxpdmVFbmRwb2ludCArXG4gICAgICBgL2NvbGxlY3Rpb24vJHt0aGlzLmNvbGxlY3Rpb25JRH0vbGl2ZT9hdXRob3JpemF0aW9uPSR7dG9rZW59Jm5lc3RlZElEPSR7bmVzdGVkSUR9Jml0ZW1JRD0ke3RoaXMuX2l0ZW19YDtcbiAgICB0aGlzLmNsaWVudCA9IG5ldyBFdmVudFNvdXJjZSh1cmwpO1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuXG4gICAgY29uc3QgZXJyb3JIYW5kbGVyID0gYXN5bmMgKGV2ZW50KSA9PiB7XG4gICAgICBpZiAodGhhdC5jbGllbnQucmVhZHlTdGF0ZSA9PT0gRXZlbnRTb3VyY2UuQ0xPU0VEKSB7XG4gICAgICAgIGlmIChhd2FpdCB0aGF0Lmluc3RhbmNlLnVzZXJzKCkuX2JhZ2VsVXNlckFjdGl2ZSgpKSB7XG4gICAgICAgICAgYXdhaXQgdGhhdC5pbnN0YW5jZS51c2VycygpLnJlZnJlc2goKTtcbiAgICAgICAgICB0b2tlbiA9IGF3YWl0IHRoYXQuaW5zdGFuY2UudXNlcnMoKS5fZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICBjb25zdCB1cmwgPVxuICAgICAgICAgICAgbGl2ZUVuZHBvaW50ICtcbiAgICAgICAgICAgIGAvY29sbGVjdGlvbi8ke3RoYXQuY29sbGVjdGlvbklEfS9saXZlP2F1dGhvcml6YXRpb249JHt0b2tlbn0mcmVxdWVzdElEPSR7dGhhdC5yZXF1ZXN0SUR9Jm5lc3RlZElEPSR7bmVzdGVkSUR9Jml0ZW1JRD0ke3RoYXQuX2l0ZW19YDtcbiAgICAgICAgICB0aGF0LmNsaWVudCA9IG5ldyBFdmVudFNvdXJjZSh1cmwpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG9uZXJyb3IpIHtcbiAgICAgICAgb25lcnJvcihldmVudCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuY2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdGFydFwiLCBmdW5jdGlvbiAoZTogRXZlbnQgJiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSB7XG4gICAgICB0aGF0LnJlcXVlc3RJRCA9IGUuZGF0YTtcbiAgICB9KTtcblxuICAgIHRoaXMuY2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdG9wXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmIChhd2FpdCB0aGF0Lmluc3RhbmNlLnVzZXJzKCkuX2JhZ2VsVXNlckFjdGl2ZSgpKSB0b2tlbiA9IGF3YWl0IHRoYXQuaW5zdGFuY2UudXNlcnMoKS5fZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgIGVsc2UgdG9rZW4gPSB0aGF0LmFwaVRva2VuO1xuXG4gICAgICB0aGF0LmNsaWVudC5jbG9zZSgpO1xuICAgICAgY29uc3QgdXJsID1cbiAgICAgICAgbGl2ZUVuZHBvaW50ICtcbiAgICAgICAgYC9jb2xsZWN0aW9uLyR7dGhhdC5jb2xsZWN0aW9uSUR9L2xpdmU/YXV0aG9yaXphdGlvbj0ke3Rva2VufSZyZXF1ZXN0SUQ9JHt0aGF0LnJlcXVlc3RJRH0mbmVzdGVkSUQ9JHtuZXN0ZWRJRH0maXRlbUlEPSR7dGhhdC5faXRlbX1gO1xuICAgICAgdGhhdC5jbGllbnQgPSBuZXcgRXZlbnRTb3VyY2UodXJsKTtcbiAgICAgIHRoYXQuY2xpZW50Lm9ubWVzc2FnZSA9IG9ubWVzc2FnZTtcbiAgICAgIHRoYXQuY2xpZW50Lm9uZXJyb3IgPSBlcnJvckhhbmRsZXI7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNsaWVudC5vbm1lc3NhZ2UgPSBvbm1lc3NhZ2U7XG4gICAgdGhpcy5jbGllbnQub25lcnJvciA9IGVycm9ySGFuZGxlcjtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gIH1cbn1cbiIsImltcG9ydCB7IEF4aW9zUHJvbWlzZSB9IGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHsgYmFzZUVuZHBvaW50IH0gZnJvbSBcIi4vY29tbW9uXCI7XG5pbXBvcnQgeyBCYWdlbERCUmVxdWVzdCB9IGZyb20gXCIuL2NvbW1vblwiO1xuaW1wb3J0IHsgc3RydWN0QXJncyB9IGZyb20gXCIuL2ludGVyZmFjZXNcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJhZ2VsTWV0YVJlcXVlc3QgZXh0ZW5kcyBCYWdlbERCUmVxdWVzdCB7XG4gIGNvbnN0cnVjdG9yKHsgaW5zdGFuY2UsIGNvbGxlY3Rpb25JRCB9OiBzdHJ1Y3RBcmdzKSB7XG4gICAgc3VwZXIoeyBpbnN0YW5jZSwgY29sbGVjdGlvbklEIH0pO1xuICB9XG5cbiAgZ2V0KCk6IEF4aW9zUHJvbWlzZSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHVybCA9IGAke2Jhc2VFbmRwb2ludH0vY29sbGVjdGlvbi8ke3RoaXMuY29sbGVjdGlvbklEfS9zY2hlbWFgO1xuICAgICAgdGhpcy5pbnN0YW5jZS5heGlvc0luc3RhbmNlXG4gICAgICAgIC5nZXQodXJsKVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPj0gMjAwICYmIHJlcy5zdGF0dXMgPCA0MDApIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KHJlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuIiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJsb2Rhc2gtZXNcIik7IiwiXG5pbXBvcnQgeyBBeGlvc0luc3RhbmNlLCBBeGlvc1Byb21pc2UgfSBmcm9tIFwiLi9jb21tb25cIjtcbmltcG9ydCB7IGJhZ2VsVHlwZSwgQmFnZWxVc2VyIH0gZnJvbSBcIi4vaW50ZXJmYWNlc1wiO1xuaW1wb3J0IEZhbGxiYWNrU3RvcmFnZSAgZnJvbSAnLi9mYlN0b3JhZ2UnO1xuXG5cbmNvbnN0IEFVVEhfRU5EUE9JTlQgPSBcImh0dHBzOi8vYXV0aC5iYWdlbGRiLmNvbS9hcGkvcHVibGljXCI7XG5cbmlmICghZ2xvYmFsVGhpcz8ubG9jYWxTdG9yYWdlKSB7XG4gIGdsb2JhbFRoaXMubG9jYWxTdG9yYWdlID0gbmV3IEZhbGxiYWNrU3RvcmFnZSh7fSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJhZ2VsVXNlcnNSZXF1ZXN0IHtcbiAgaW5zdGFuY2U6IGJhZ2VsVHlwZTtcbiAgYXhpb3M6IEF4aW9zSW5zdGFuY2U7XG4gIGJhZ2VsU3RvcmFnZTogU3RvcmFnZTtcbiAgW3g6IHN0cmluZ106IGFueTtcblxuICBjb25zdHJ1Y3Rvcih7IGluc3RhbmNlIH06IHsgaW5zdGFuY2U6IGJhZ2VsVHlwZX0pIHtcbiAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgdGhpcy5heGlvcyA9IHRoaXMuaW5zdGFuY2UuYXhpb3NJbnN0YW5jZTtcbiAgICB0aGlzLmJhZ2VsU3RvcmFnZSA9IHRoaXMuaW5zdGFuY2U/LmN1c3RvbVN0b3JhZ2UgfHwgZ2xvYmFsVGhpcz8ubG9jYWxTdG9yYWdlO1xuICB9XG5cbiAgX2lzQnJvd3NlcigpOiBib29sZWFuIHtcbiAgICBjb25zdCBpc05vZGUgPSBuZXcgRnVuY3Rpb24oXG4gICAgICBcInRyeSB7cmV0dXJuIHRoaXM9PT1nbG9iYWw7fWNhdGNoKGUpe3JldHVybiBmYWxzZTt9XCJcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiAhaXNOb2RlKCk7XG4gIH1cblxuICBhc3luYyBfYmFnZWxVc2VyQWN0aXZlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGlzQnJvd3NlciA9ICB0aGlzLl9pc0Jyb3dzZXIoKTtcbiAgIGNvbnN0IGJhZ2VsVXNlcklEID0gYXdhaXQgdGhpcy5nZXRCYWdlbFVzZXJJRCgpO1xuICAgIHJldHVybiAoXG4gICAgICBpc0Jyb3dzZXIgJiYgYmFnZWxVc2VySUQgIT09IG51bGwgJiYgYmFnZWxVc2VySUQubGVuZ3RoID4gMFxuICAgICk7XG4gIH1cblxuICBjcmVhdGUoZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IEF4aW9zUHJvbWlzZTxhbnk+IHtcbiAgICBlbWFpbCA9IGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCB1cmwgPSBgJHtBVVRIX0VORFBPSU5UfS91c2VyYDtcbiAgICAgIGNvbnN0IGJvZHkgPSB7IGVtYWlsLCBwYXNzd29yZCB9O1xuICAgICAgdGhpcy5heGlvc1xuICAgICAgICAucG9zdCh1cmwsIGJvZHkpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PSAyMDEpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gcmVzO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UuaXNTZXJ2ZXIpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhLnVzZXJfaWQpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zdG9yZVRva2VucyhkYXRhKTtcbiAgICAgICAgICAgIHRoaXMuX3N0b3JlQmFnZWxVc2VyKGRhdGEudXNlcl9pZCk7XG4gICAgICAgICAgICByZXNvbHZlKGRhdGEudXNlcl9pZCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChyZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvLy8gVmFsaWRhdGUgdGhlIHVzZXIncyByZWNlaXZlZCBPbmUgVGltZSBQYXNzd29yZFxuICBhc3luYyB2YWxpZGF0ZU90cChvdHA6IFJlY29yZDxzdHJpbmcsIGFueT4pIHtcbiAgICBjb25zdCBub25jZSA9IGF3YWl0IHRoaXMuX2dldE90cFJlcXVlc3ROb25jZSgpO1xuICAgIGNvbnN0IHVybCA9IGAke0FVVEhfRU5EUE9JTlR9L3VzZXIvb3RwL3ZlcmlmeS8ke25vbmNlfWA7XG4gICAgY29uc3QgYm9keSA9IHsgb3RwIH07XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuYXhpb3MucG9zdCh1cmwsIGJvZHkpO1xuICAgICAgdGhpcy5fc3RvcmVUb2tlbnMocmVzLmRhdGEpO1xuICAgICAgcmV0dXJuIHJlcy5kYXRhW1widXNlcl9pZFwiXTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93IFwid3JvbmcgYXV0aG9yaXphdGlvbiBjb2RlXCI7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgX2dldE90cFJlcXVlc3ROb25jZSgpIHtcbiAgICBjb25zdCBvdHBSZXF1ZXN0ID0gYXdhaXQgdGhpcy5iYWdlbFN0b3JhZ2UuZ2V0SXRlbShcImJhZ2VsLW5vbmNlXCIpO1xuICAgIGNvbnN0IGV4cGlyZXMgPSArKGF3YWl0IHRoaXMuYmFnZWxTdG9yYWdlLmdldEl0ZW0oXCJiYWdlbC1leHBpcmVzXCIpIHx8IFwiXCIpO1xuICAgIGlmIChvdHBSZXF1ZXN0ICYmIGV4cGlyZXMpIHtcbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgaWYgKGV4cGlyZXMgPD0gZGF0ZS5zZXRTZWNvbmRzKGRhdGUuZ2V0U2Vjb25kcygpKSlcbiAgICAgICAgdGhyb3cgXCJPVFAgcmVxdWVzdCBoYXMgZXhwaXJlZCwgdHJ5IGFnYWluXCI7XG4gICAgICByZXR1cm4gb3RwUmVxdWVzdDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgXCJSZXF1ZXN0IGFuIE9UUCBmaXJzdFwiO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlcXVlc3RPdHAoZW1haWxPclBob25lOiBzdHJpbmcpIHtcbiAgICBlbWFpbE9yUGhvbmUgPSBlbWFpbE9yUGhvbmUudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgY29uc3QgdXJsID0gYCR7QVVUSF9FTkRQT0lOVH0vdXNlci9vdHBgO1xuICAgIGNvbnN0IGJvZHkgPSB7IGVtYWlsT3JQaG9uZTogZW1haWxPclBob25lIH07XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuYXhpb3MucG9zdCh1cmwsIGJvZHkpO1xuICAgICAgYXdhaXQgdGhpcy5fc3RvcmVPdHBSZXF1ZXN0Tm9uY2UocmVzLmRhdGEpO1xuICAgICAgcmV0dXJuIHJlcy5kYXRhW1wibm9uY2VcIl07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBfc3RvcmVPdHBSZXF1ZXN0Tm9uY2Uoe1xuICAgIG5vbmNlLFxuICAgIGV4cGlyZXNfaW4sXG4gIH06IHtcbiAgICBub25jZTogc3RyaW5nO1xuICAgIGV4cGlyZXNfaW46IG51bWJlcjtcbiAgfSkge1xuICAgIGNvbnN0IGV4cGlyZXMgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHN0b3JlZEV4cGlyZSA9IGAke2V4cGlyZXMuc2V0U2Vjb25kcyhcbiAgICAgIGV4cGlyZXMuZ2V0U2Vjb25kcygpICsgZXhwaXJlc19pblxuICAgICl9YDtcbiAgIGF3YWl0IHRoaXMuYmFnZWxTdG9yYWdlLnNldEl0ZW0oXCJiYWdlbC1ub25jZVwiLCBub25jZSk7XG4gICBhd2FpdCB0aGlzLmJhZ2VsU3RvcmFnZS5zZXRJdGVtKFwiYmFnZWwtZXhwaXJlc1wiLCBzdG9yZWRFeHBpcmUpO1xuICB9XG5cbiAgdmFsaWRhdGUoZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IEF4aW9zUHJvbWlzZTxhbnk+IHtcbiAgICBlbWFpbCA9IGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCB1cmwgPSBgJHtBVVRIX0VORFBPSU5UfS91c2VyL3ZlcmlmeWA7XG4gICAgICBjb25zdCBib2R5ID0geyBlbWFpbCwgcGFzc3dvcmQgfTtcbiAgICAgIHRoaXMuYXhpb3NcbiAgICAgICAgLnBvc3QodXJsLCBib2R5KVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgICBjb25zdCB7IGRhdGEgfSA9IHJlcztcbiAgICAgICAgICAgIHRoaXMuX3N0b3JlVG9rZW5zKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5fc3RvcmVCYWdlbFVzZXIoZGF0YS51c2VyX2lkKTtcbiAgICAgICAgICAgIHJlc29sdmUoZGF0YS51c2VyX2lkKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KHJlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXIoKTogQXhpb3NQcm9taXNlPEJhZ2VsVXNlcj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAoIXRoaXMuX2JhZ2VsVXNlckFjdGl2ZSgpKSB7XG4gICAgICAgIHJlamVjdChcbiAgICAgICAgICBuZXcgRXJyb3IoXCJhIEJhZ2VsIFVzZXIgbXVzdCBiZSBsb2dnZWQgaW4gdG8gZ2V0IEJhZ2VsIFVzZXIgaW5mb1wiK3RoaXMuX2JhZ2VsVXNlckFjdGl2ZSgpKVxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCB1cmwgPSBgJHtBVVRIX0VORFBPSU5UfS91c2VyYDtcbiAgICAgIHRoaXMuYXhpb3NcbiAgICAgICAgLmdldCh1cmwpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KHJlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlcXVlc3RQYXNzd29yZFJlc2V0KGVtYWlsOiBzdHJpbmcpOiBBeGlvc1Byb21pc2U8dW5rbm93bj4ge1xuICAgIGVtYWlsID0gZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHVybCA9IGAke0FVVEhfRU5EUE9JTlR9L3VzZXIvcmVzZXRwYXNzd29yZGA7XG4gICAgICBjb25zdCBib2R5ID0geyBlbWFpbCB9O1xuICAgICAgdGhpcy5heGlvc1xuICAgICAgICAucG9zdCh1cmwsIGJvZHkpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KHJlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZVBhc3N3b3JkKGVtYWlsOiBzdHJpbmcsIHVwZGF0ZWRQYXNzd29yZDogc3RyaW5nKTogQXhpb3NQcm9taXNlPHVua25vd24+IHtcbiAgICBlbWFpbCA9IGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAodGhpcy5faXNCcm93c2VyKCkpIHtcbiAgICAgICAgcmVqZWN0KFxuICAgICAgICAgIG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiVXBkYXRlIFBhc3N3b3JkIGZlYXR1cmUgaXMgb25seSBhdmFpbGFibGUgd2hlbiB1c2luZyBOb2RlSlNcIlxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgdXJsID0gYCR7QVVUSF9FTkRQT0lOVH0vdXNlci91cGRhdGVQYXNzd29yZGA7XG4gICAgICBjb25zdCBib2R5ID0geyBlbWFpbDogZW1haWwsIHBhc3N3b3JkOiB1cGRhdGVkUGFzc3dvcmQgfTtcbiAgICAgIHRoaXMuYXhpb3NcbiAgICAgICAgLnBvc3QodXJsLCBib2R5KVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChyZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBfc3RvcmVCYWdlbFVzZXIodXNlcklEOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgIGF3YWl0IHRoaXMuYmFnZWxTdG9yYWdlLnNldEl0ZW0oXCJiYWdlbC11c2VyXCIsIHVzZXJJRCk7XG4gIH1cblxuICBhc3luYyBfc3RvcmVUb2tlbnMoZGF0YTogUmVjb3JkPHN0cmluZywgYW55Pik6IFByb21pc2U8dm9pZD4ge1xuICAgYXdhaXQgdGhpcy5iYWdlbFN0b3JhZ2Uuc2V0SXRlbShcImJhZ2VsLWFjY2Vzc1wiLCBkYXRhLmFjY2Vzc190b2tlbik7XG4gICAgY29uc3QgZXhwaXJlczogYW55ID0gbmV3IERhdGUoKTtcbiAgICBleHBpcmVzLnNldFNlY29uZHMoZXhwaXJlcy5nZXRTZWNvbmRzKCkgKyBkYXRhLmV4cGlyZXNfaW4pO1xuICAgYXdhaXQgdGhpcy5iYWdlbFN0b3JhZ2Uuc2V0SXRlbShcImJhZ2VsLWV4cGlyZXNcIiwgZXhwaXJlcyk7XG4gICBhd2FpdCB0aGlzLmJhZ2VsU3RvcmFnZS5zZXRJdGVtKFwiYmFnZWwtcmVmcmVzaFwiLCBkYXRhLnJlZnJlc2hfdG9rZW4pO1xuICB9XG5cbiAgYXN5bmMgZ2V0QmFnZWxVc2VySUQoKXtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5iYWdlbFN0b3JhZ2UuZ2V0SXRlbShcImJhZ2VsLXVzZXJcIikgYXMgc3RyaW5nO1xuICB9XG5cbiAgYXN5bmMgX2dldFJlZnJlc2hUb2tlbigpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5iYWdlbFN0b3JhZ2UuZ2V0SXRlbShcImJhZ2VsLXJlZnJlc2hcIik7XG4gIH1cblxuICBhc3luYyBfZ2V0QWNjZXNzVG9rZW4oKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsIHwgQXhpb3NQcm9taXNlPHN0cmluZz4+IHtcbiAgICBjb25zdCBlID0gYXdhaXQgdGhpcy5iYWdlbFN0b3JhZ2UuZ2V0SXRlbShcImJhZ2VsLWV4cGlyZXNcIikgfHwgXCJcIjtcbiAgICBjb25zdCBleHBpcmVzID0gbmV3IERhdGUoZSk7XG4gICAgaWYgKGV4cGlyZXMgPD0gbmV3IERhdGUoKSkgcmV0dXJuIHRoaXMucmVmcmVzaCgpO1xuICAgIGVsc2UgcmV0dXJuIGF3YWl0IHRoaXMuYmFnZWxTdG9yYWdlLmdldEl0ZW0oXCJiYWdlbC1hY2Nlc3NcIik7XG4gIH1cblxuICBhc3luYyBsb2dvdXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICBhd2FpdCB0aGlzLmJhZ2VsU3RvcmFnZS5yZW1vdmVJdGVtKFwiYmFnZWwtdXNlclwiKTtcbiAgIGF3YWl0IHRoaXMuYmFnZWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJiYWdlbC1hY2Nlc3NcIik7XG4gICBhd2FpdCB0aGlzLmJhZ2VsU3RvcmFnZS5yZW1vdmVJdGVtKFwiYmFnZWwtcmVmcmVzaFwiKTtcbiAgfVxuXG4gIHJlZnJlc2goKTogQXhpb3NQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAoIXRoaXMuX2dldFJlZnJlc2hUb2tlbigpKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJObyBCYWdlbCBVc2VyIGlzIGxvZ2dlZCBpblwiKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHVybCA9IGAke0FVVEhfRU5EUE9JTlR9L3VzZXIvdG9rZW5gO1xuICAgICAgY29uc3QgYm9keSA9IGBncmFudF90eXBlPXJlZnJlc2hfdG9rZW4mcmVmcmVzaF90b2tlbj0ke3RoaXMuX2dldFJlZnJlc2hUb2tlbigpfSZjbGllbnRfaWQ9cHJvamVjdC1jbGllbnRgO1xuICAgICAgdGhpcy5heGlvc1xuICAgICAgICAucG9zdCh1cmwsIGJvZHkpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBjb25zdCB7IGRhdGEgfSA9IHJlcztcbiAgICAgICAgICAgIHRoaXMuX3N0b3JlVG9rZW5zKGRhdGEpO1xuICAgICAgICAgICAgcmVzb2x2ZShkYXRhLmFjY2Vzc190b2tlbik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChyZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsIiBpbXBvcnQge2lzVW5kZWZpbmVkLCB3aXRob3V0LCBrZXlzLCBzaXplLCBpbmNsdWRlc30gZnJvbSAnbG9kYXNoLWVzJztcblxuIGV4cG9ydCBkZWZhdWx0IGNsYXNzIEZhbGxiYWNrU3RvcmFnZSB7XG4gICAga2V5OiAoaW5kZXg6IGFueSkgPT4gYW55XG4gICAgc2V0SXRlbTogKGtleTogYW55LCB2YWx1ZTogYW55KSA9PiB2b2lkXG4gICAgZ2V0SXRlbTogKGtleTogYW55KSA9PiBhbnlcbiAgICByZW1vdmVJdGVtOiAoa2V5OiBhbnkpID0+IHZvaWRcbiAgICBjbGVhcjogKCkgPT4gdm9pZFxuICAgIGxlbmd0aDogbnVtYmVyXG4gICAgX19wcm90ZWN0ZWQ6ICgpID0+IHsgZGF0YTogYW55OyB9XG5cbiBjb25zdHJ1Y3RvciAoZGF0YSkge1xuXG4gICAgIGxldCBzdG9yYWdlID0gdGhpcztcblxuICAgICBpZiAoIWRhdGEpIGRhdGEgPSB7fTtcblxuICAgICBsZXQga2V5bGlzdCA9IGtleXMoZGF0YSk7XG5cbiAgICAgbGV0IG51bGxPclZhbHVlID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICByZXR1cm4gaXNVbmRlZmluZWQodmFsdWUpID8gbnVsbCA6IHZhbHVlO1xuICAgICB9O1xuXG4gICAgIHRoaXMua2V5ID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgIGxldCBrZXkgPSBrZXlsaXN0W2luZGV4XTtcbiAgICAgICAgIHJldHVybiBudWxsT3JWYWx1ZShrZXkpO1xuICAgICB9O1xuXG4gICAgIHRoaXMuc2V0SXRlbSA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgIGlmICghaW5jbHVkZXMoa2V5bGlzdCwga2V5KSkga2V5bGlzdC5wdXNoKGtleSk7XG4gICAgICAgICBkYXRhWyBrZXkgXSA9IHZhbHVlO1xuICAgICAgICAgc3RvcmFnZS5sZW5ndGggPSBzaXplKCBkYXRhICk7XG4gICAgIH07XG5cbiAgICAgdGhpcy5nZXRJdGVtID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICBsZXQgdmFsdWUgPSBkYXRhWyBrZXkgXTtcbiAgICAgICAgIHJldHVybiBudWxsT3JWYWx1ZSh2YWx1ZSk7XG4gICAgIH07XG5cbiAgICAgdGhpcy5yZW1vdmVJdGVtID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgZGVsZXRlIGRhdGEgWyBrZXkgXTtcbiAgICAgICBrZXlsaXN0ID0gd2l0aG91dCgga2V5bGlzdCwga2V5ICk7XG4gICAgICAgc3RvcmFnZS5sZW5ndGggPSBzaXplKCBkYXRhICk7XG4gICAgIH07XG5cbiAgICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgbGV0IF9rZXlzID0ga2V5cyggZGF0YSApO1xuICAgICAgICAgbGV0IHJlbW92ZSA9IHRoaXMucmVtb3ZlSXRlbTtcbiAgICAgICAgIF9rZXlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICAgcmVtb3ZlKGtleSk7XG4gICAgICAgICB9KTtcbiAgICAgfTtcblxuICAgICB0aGlzLmxlbmd0aCA9IHNpemUoIGRhdGEgKTtcblxuICAgICB0aGlzLl9fcHJvdGVjdGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgIGRhdGFcbiAgICAgICAgIH07XG4gICAgIH07XG5cbiAgICB9XG4gfTtcblxuXG4iLCJpbXBvcnQgYXhpb3MsIHsgQXhpb3NJbnN0YW5jZSwgQXhpb3NQcm9taXNlIH0gZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgQmFnZWxEQlJlcXVlc3QgZnJvbSBcIi4vYmFnZWxEQlJlcXVlc3RcIjtcbmltcG9ydCBCYWdlbE1ldGFSZXF1ZXN0IGZyb20gXCIuL2JhZ2VsTWV0YVJlcXVlc3RcIjtcbmltcG9ydCBCYWdlbFVzZXJzUmVxdWVzdCBmcm9tIFwiLi91c2Vyc1wiO1xuXG5jb25zdCBiYXNlRW5kcG9pbnQgPSBcImh0dHBzOi8vYXBpLmJhZ2Vsc3R1ZGlvLmNvL2FwaS9wdWJsaWNcIjtcbmNvbnN0IGxpdmVFbmRwb2ludCA9IFwiaHR0cHM6Ly9saXZlLmJhZ2VsZGIuY29tL2FwaS9wdWJsaWNcIjtcblxuZXhwb3J0IHtcbiAgQmFnZWxVc2Vyc1JlcXVlc3QsXG4gIEJhZ2VsREJSZXF1ZXN0LFxuICBCYWdlbE1ldGFSZXF1ZXN0LFxufTtcbmV4cG9ydCB7XG4gIEF4aW9zSW5zdGFuY2UsXG4gIGF4aW9zLFxuICBiYXNlRW5kcG9pbnQsXG4gIGxpdmVFbmRwb2ludCxcbiAgQXhpb3NQcm9taXNlXG59O1xuIiwiaW1wb3J0IHsgQXhpb3NJbnN0YW5jZSwgQXhpb3NSZXF1ZXN0SGVhZGVycyB9IGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHtcbiAgQmFnZWxEQlJlcXVlc3QsXG4gIEJhZ2VsTWV0YVJlcXVlc3QsXG4gIEJhZ2VsVXNlcnNSZXF1ZXN0LFxuICBheGlvcyxcbn0gZnJvbSBcIi4vY29tbW9uXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCYWdlbCB7XG4gIFt4OiBzdHJpbmddOiBhbnk7XG4gIGlzU2VydmVyOiBib29sZWFuO1xuICBjdXN0b21TdG9yYWdlOiAgU3RvcmFnZSB8IHVuZGVmaW5lZDtcbiAgYXBpVG9rZW46IHN0cmluZztcbiAgYXhpb3NJbnN0YW5jZTogQXhpb3NJbnN0YW5jZTtcbiAgY29uc3RydWN0b3IoYXBpVG9rZW46IHN0cmluZywgb3B0aW9uczoge2lzU2VydmVyPzogYm9vbGVhbjsgY3VzdG9tU3RvcmFnZT86IFN0b3JhZ2UgfCB1bmRlZmluZWQ7IH0gPSB7IGlzU2VydmVyOiBmYWxzZSwgY3VzdG9tU3RvcmFnZTogdW5kZWZpbmVkIH0pIHtcbiAgICB0aGlzLmlzU2VydmVyID0gISFvcHRpb25zLmlzU2VydmVyO1xuICAgIHRoaXMuY3VzdG9tU3RvcmFnZSA9IG9wdGlvbnMuY3VzdG9tU3RvcmFnZTtcbiAgICB0aGlzLmFwaVRva2VuID0gYXBpVG9rZW47XG4gICAgdGhpcy5heGlvc0luc3RhbmNlID0gYXhpb3MuY3JlYXRlKCk7XG4gICAgdGhpcy5heGlvc0luc3RhbmNlLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShcbiAgICAgIGFzeW5jIChjb25maWcpID0+IHtcbiAgICAgICAgKGNvbmZpZy5oZWFkZXJzIGFzIEF4aW9zUmVxdWVzdEhlYWRlcnMpW1wiQWNjZXB0LVZlcnNpb25cIl0gPSBcInYxXCI7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBhd2FpdCBuZXcgQmFnZWxVc2Vyc1JlcXVlc3QoeyBpbnN0YW5jZTogdGhpcyB9KS5fYmFnZWxVc2VyQWN0aXZlKCkgJiZcbiAgICAgICAgICAhY29uZmlnLnVybD8uaW5jbHVkZXMoXCJ1c2VyL3Rva2VuXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gbmV3IEJhZ2VsVXNlcnNSZXF1ZXN0KHtcbiAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzLFxuICAgICAgICAgIH0pLl9nZXRBY2Nlc3NUb2tlbigpO1xuICAgICAgICAgIChjb25maWcuaGVhZGVycyBhcyBBeGlvc1JlcXVlc3RIZWFkZXJzKS5BdXRob3JpemF0aW9uID0gXCJCZWFyZXIgXCIgKyBhY2Nlc3NUb2tlbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAoY29uZmlnLmhlYWRlcnMgYXMgQXhpb3NSZXF1ZXN0SGVhZGVycykuQXV0aG9yaXphdGlvbiA9IFwiQmVhcmVyIFwiICsgYXBpVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgIH0sXG4gICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5heGlvc0luc3RhbmNlLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoXG4gICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIChlcnJvcikgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgYXdhaXQgbmV3IEJhZ2VsVXNlcnNSZXF1ZXN0KHsgaW5zdGFuY2U6IHRoaXMgfSkuX2JhZ2VsVXNlckFjdGl2ZSgpICYmXG4gICAgICAgICAgZXJyb3IucmVzcG9uc2UgJiZcbiAgICAgICAgICBlcnJvci5yZXNwb25zZS5zdGF0dXMgPT0gNDAxICYmXG4gICAgICAgICAgIWVycm9yLmNvbmZpZy51cmwuaW5jbHVkZXMoXCJ1c2VyL3Rva2VuXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBuZXcgQmFnZWxVc2Vyc1JlcXVlc3QoeyBpbnN0YW5jZTogdGhpcyB9KVxuICAgICAgICAgICAgLnJlZnJlc2goKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjb25maWcgPSBlcnJvci5jb25maWc7XG4gICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IGBCZWFyZXIgJHtuZXcgQmFnZWxVc2Vyc1JlcXVlc3QoXG4gICAgICAgICAgICAgICAgeyBpbnN0YW5jZTogdGhpcyB9XG4gICAgICAgICAgICAgICkuX2dldEFjY2Vzc1Rva2VuKCl9YDtcbiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBheGlvc1xuICAgICAgICAgICAgICAgICAgLnJlcXVlc3QoY29uZmlnKVxuICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgc2NoZW1hKGNvbGxlY3Rpb25JRDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBCYWdlbE1ldGFSZXF1ZXN0KHsgaW5zdGFuY2U6IHRoaXMsIGNvbGxlY3Rpb25JRCB9KTtcbiAgfVxuXG4gIGNvbGxlY3Rpb24oY29sbGVjdGlvbklEOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IEJhZ2VsREJSZXF1ZXN0KHsgaW5zdGFuY2U6IHRoaXMsIGNvbGxlY3Rpb25JRCB9KTtcbiAgfVxuXG4gIHVzZXJzKCkge1xuICAgIHJldHVybiBuZXcgQmFnZWxVc2Vyc1JlcXVlc3QoeyBpbnN0YW5jZTogdGhpcyB9KTtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgQVNDKCkge1xuICAgIHJldHVybiBcIkFTQ1wiO1xuICB9XG5cbiAgc3RhdGljIGdldCBERVNDKCkge1xuICAgIHJldHVybiBcIkRFU0NcIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgRVFVQUwoKSB7XG4gICAgcmV0dXJuIFwiPVwiO1xuICB9XG5cbiAgc3RhdGljIGdldCBOT1RfRVFVQUwoKSB7XG4gICAgcmV0dXJuIFwiIT1cIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgR1JFQVRFUl9USEFOKCkge1xuICAgIHJldHVybiBcIj5cIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgTEVTU19USEFOKCkge1xuICAgIHJldHVybiBcIjxcIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgV0lUSElOKCkge1xuICAgIHJldHVybiBcIndpdGhpblwiO1xuICB9XG5cbiAgc3RhdGljIEdlb1BvaW50UXVlcnkobGF0OiBudW1iZXIsIGxuZzogbnVtYmVyLCBkaXN0YW5jZTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIGAke2xhdH0sJHtsbmd9LCR7ZGlzdGFuY2V9YDtcbiAgfVxufVxuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiZm9ybS1kYXRhXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcInRzbGliXCIpOyIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiXSwibmFtZXMiOlsicmVxdWlyZSIsImluc3RhbmNlIiwiY29sbGVjdGlvbklEIiwidGhpcyIsIl9wYWdlTnVtYmVyIiwiaXRlbXNQZXJQYWdlIiwiY2FsbEV2ZXJ5dGhpbmciLCJfcXVlcnkiLCJuZXN0ZWRDb2xsZWN0aW9uc0lEcyIsImF4aW9zSW5zdGFuY2UiLCJhcGlUb2tlbiIsIl9wcm9qZWN0T24iLCJfcHJvamVjdE9mZiIsInJlcXVlc3RJRCIsInNvcnRGaWVsZCIsInNvcnRPcmRlciIsIl9pdGVtIiwiX2ZpZWxkIiwicGFnZU51bWJlciIsInBlclBhZ2UiLCJjb2xsZWN0aW9uU2x1ZyIsInB1c2giLCJfaWQiLCJsZW5ndGgiLCJrZXkiLCJvcGVyYXRvciIsInZhbHVlIiwiQXJyYXkiLCJpc0FycmF5Iiwiam9pbiIsInF1ZXJ5IiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiZmllbGQiLCJvcmRlciIsInNsdWdzIiwiaW1hZ2VTbHVnIiwiZm9ybSIsInNlbGVjdGVkSW1hZ2UiLCJpbWFnZUxpbmsiLCJhbHRUZXh0IiwiZmlsZU5hbWUiLCJpc05vZGUiLCJGdW5jdGlvbiIsIkZvcm1EYXRhIiwiZm9ybUhlYWRlcnMiLCJuZXN0ZWRJRCIsImFwcGVuZCIsImdldEhlYWRlcnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInVybCIsImJhc2VFbmRwb2ludCIsInB1dCIsImhlYWRlcnMiLCJ0aGVuIiwiaW1nUmVzcG9uc2UiLCJjYXRjaCIsImVyciIsImRlbGV0ZSIsInJlcyIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwicG9zdCIsImVycm9yIiwiZmllbGRTbHVnIiwibWF0Y2giLCJpbmNyZW1lbnRWYWx1ZSIsImlzTmFOIiwicGFyc2VGbG9hdCIsImRlY3JlbWVudFZhbHVlIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiU3RyaW5nIiwiaXRlbUlEIiwidG9TdHJpbmciLCJnZXQiLCJzdGF0dXMiLCJFcnJvciIsImJhZ2VsVXNlcklEIiwidXNlcklEIiwib25tZXNzYWdlIiwib25lcnJvciIsInVzZXJzIiwiX2JhZ2VsVXNlckFjdGl2ZSIsIl9nZXRBY2Nlc3NUb2tlbiIsInRva2VuIiwibGl2ZUVuZHBvaW50IiwiY2xpZW50IiwiRXZlbnRTb3VyY2UiLCJ0aGF0IiwiZXJyb3JIYW5kbGVyIiwiZXZlbnQiLCJyZWFkeVN0YXRlIiwiQ0xPU0VEIiwicmVmcmVzaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY2xvc2UiLCJBVVRIX0VORFBPSU5UIiwiZ2xvYmFsVGhpcyIsImxvY2FsU3RvcmFnZSIsInN0b3JhZ2UiLCJrZXlsaXN0Iiwia2V5cyIsIm51bGxPclZhbHVlIiwiaXNVbmRlZmluZWQiLCJpbmRleCIsInNldEl0ZW0iLCJpbmNsdWRlcyIsInNpemUiLCJnZXRJdGVtIiwicmVtb3ZlSXRlbSIsIndpdGhvdXQiLCJjbGVhciIsIl9rZXlzIiwicmVtb3ZlIiwiZm9yRWFjaCIsIl9fcHJvdGVjdGVkIiwiYXhpb3MiLCJiYWdlbFN0b3JhZ2UiLCJjdXN0b21TdG9yYWdlIiwiaXNCcm93c2VyIiwiX2lzQnJvd3NlciIsImdldEJhZ2VsVXNlcklEIiwiZW1haWwiLCJwYXNzd29yZCIsInRvTG93ZXJDYXNlIiwidHJpbSIsImJvZHkiLCJpc1NlcnZlciIsInVzZXJfaWQiLCJfc3RvcmVUb2tlbnMiLCJfc3RvcmVCYWdlbFVzZXIiLCJvdHAiLCJfZ2V0T3RwUmVxdWVzdE5vbmNlIiwibm9uY2UiLCJvdHBSZXF1ZXN0IiwiZXhwaXJlcyIsImRhdGUiLCJEYXRlIiwic2V0U2Vjb25kcyIsImdldFNlY29uZHMiLCJlbWFpbE9yUGhvbmUiLCJfc3RvcmVPdHBSZXF1ZXN0Tm9uY2UiLCJleHBpcmVzX2luIiwic3RvcmVkRXhwaXJlIiwidXBkYXRlZFBhc3N3b3JkIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsIl9nZXRSZWZyZXNoVG9rZW4iLCJvcHRpb25zIiwidW5kZWZpbmVkIiwiaW50ZXJjZXB0b3JzIiwicmVxdWVzdCIsInVzZSIsImNvbmZpZyIsImFjY2Vzc1Rva2VuIiwiQXV0aG9yaXphdGlvbiIsInJlc3BvbnNlIiwibGF0IiwibG5nIiwiZGlzdGFuY2UiLCJtb2R1bGUiLCJleHBvcnRzIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciXSwic291cmNlUm9vdCI6IiJ9